!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m",function(exports){return t(e,exports)}):e.M=t(e,{})}(this,function(e,t){function n(e){if(!("classList"in e)){e.classList={node:e};for(var t in x)e.classList[t.slice(1)]=x[t]}return e.classList}var i=function(e,t,n){n||(n=null);for(var i=0,r=e.length;r>i&&!1!==t.call(n,e[i],i,e);i++);},r=function(e){return e+="",e.replace(/#.*/,"")},a=e.location,s=e.document,o=s.body,h=s.createElement("a"),u=function(e){return h.href=e,d(h)},c=function(e){return h.href=e,r(h.href)},l=function(e){e||(e=a);var t=e.hash;return"#"===t.charAt(0)&&(t=t.substr(1)),t},d=function(e){e||(e=a);var t=e.href,n=l(e),i=r(t);return n||(t=i),{url:t,rurl:i,host:e.host,hash:n,protocol:e.protocol,origin:e.origin||e.protocol+"//"+e.host,pathname:e.pathname,search:e.search,port:e.port}},f=function(e){var t="";do if(e!==o&&1===e.nodeType&&((t=e.getAttribute("data-href"))||(t=e.href)))break;while(e=e.parentElement);return{href:t||"",target:e}},p=function(e){return e.indexOf("-")<0?e:e.replace(/-[^-]/g,function(e){return e.charAt(1).toUpperCase()})},v=function(e){var t={};if(e.dataset)for(var n in e.dataset)t[n]=e.dataset[n];else for(var i,r,a=e.attributes,s=/^data-(.+)$/i,o=0,h=a.length;h>o;o++)i=a[o].name||a[o].nodeName,(r=i.match(s))&&(t[p(r[1])]=a[o].value||a[o].nodeValue);return t},g=Object.prototype,m=(g.hasOwnProperty,g.toString),y=function(e){return"[object Function]"==m.call(e)},w=function(e){return"[object Object]"===m.call(e)&&Object.getPrototypeOf(e)===g},C=t.extend=function(){var e,t,n,i,r,a,s=arguments[0]||{},o=1,h=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},o++),"object"==typeof s||y(s)||(s={}),o===h&&(s=this,o--);h>o;o++)if(null!=(e=arguments[o]))for(t in e)n=s[t],i=e[t],s!==i&&(u&&i&&(w(i)||(r=Array.isArray(i)))?(r?(r=!1,a=n&&Array.isArray(n)?n:[]):a=n&&w(n)?n:{},s[t]=C(u,a,i)):void 0!==i&&(s[t]=i));return s};t.nextTick=new function(){function t(){for(var e=r.length,t=0;e>t;t++)r[t]();r=r.slice(e)}var n=e.setImmediate,i=e.MutationObserver;if(n)return n.bind(e);var r=[];if(i){var a=s.createTextNode("M");return new i(t).observe(a,{characterData:!0}),function(e){r.push(e),a.data=Math.random()}}return function(e){setTimeout(e)}};var S={_eventData:null,on:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]||(this._eventData[e]=[]);var n=!1;i(this._eventData[e],function(e){return e===t?(n=!0,!1):void 0}),n||this._eventData[e].push(t)},off:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]&&this._eventData[e].length&&(t?i(this._eventData[e],function(n,i){return n===t?(this._eventData[e].splice(i,1),!1):void 0}):this._eventData[e]=[])},trigger:function(e){if(this._eventData||(this._eventData={}),this._eventData[e]){var t=this._eventData[e].slice.call(arguments,1);i(this._eventData[e],function(e){e.apply(null,t)})}}},b=function(){},k="m-"+(new Date).getTime()+"-",_=1,V={},T=function(e){var t="";return e&&(t=V[e])||(t=k+_++,e&&(V[e]=t)),t},A=/[^, ]+/g,x={_toString:function(){var e=this.node,t=e.className,n="string"==typeof t?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;rsvg.test(t)?t.setAttribute("class",e):t.className=e}};return"add,remove".replace(A,function(e){t[e+"Class"]=function(t,i){return i&&"string"==typeof i&&t&&1===t.nodeType&&i.replace(/\S+/g,function(i){n(t)[e](i)}),this}}),t.innerHTML="undefined"!=typeof $&&y($.prototype.html)?function(e,t){$(e).html(t)}:function(e,t){e.innerHTML=t},t.extend({rword:A,noop:b,each:i,trimUrl:r,parseUrl:u,getHash:l,getFullUrl:c,getHrefAndTarget:f,camelize:p,getDatesetObj:v,isFunction:y,isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},isPlainObject:w,parseLocation:d,getUIDByKey:T,hasClass:function(e,t){return 1===e.nodeType&&n(e).contains(t)},location:a,document:s,body:o,html:s.documentElement,Base:S,extendByBase:function(e){return C(e,S)},Array:{ensure:function(e,t){return-1===e.indexOf(t)?e.push(t):void 0},indexOfByKey:function(e,t,n){for(var i=t[n],r=0,a=e.length;a>r;r++)if(e[r][n]===i)return r;return-1}}}),t}),function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m.history",function(require){var n=require("m");return n.history=t(e,n),n}):M.history=t(e,e.M)}(this,function(e,t){var n={},i=[],r=function(e){return("/"+e+"/").replace(/^\/+|\/+$/g,"/")},a=t.document.getElementsByTagName("base");a=a&&a.length?r(a[0].getAttribute("href")):"/";var s=t.parseLocation().origin,o=e.history,h=(e.navigator||{}).userAgent;h||(h="");var u=parseInt((/android (\d+)/.exec(h.toLowerCase())||[])[1],10);isNaN(u)&&(u=void 0);var c=/Boxee/i.test(h),l=!(!(o&&o.pushState&&o.replaceState)||4>u||c),d={support:l,_startd:!1,index:-1,base:a,start:function(n){if(!this._startd){n||(n={});var i=n.base;t.isDefined(i)&&t.isString(i)&&(this.base=r(i)),this._startd=!0,this.options=t.extend({enablePushState:!0},n),l&&(this.options.enablePushState&&e.addEventListener("popstate",this.onChange),t.document.addEventListener("click",this.onDocClick)),this.onChange({type:"popstate",state:d.getUrlState(t.location.href)}),this.trigger("inited")}},stop:function(){l&&(this.options.enablePushState&&e.removeEventListener("popstate",this.onChange),t.document.removeEventListener("click",this.onDocClick)),this._startd=!1,this.index=-1,n={},i=[]},getPath:function(e){var n=t.parseUrl(e),i=decodeURIComponent(n.pathname+n.search),r=this.base.slice(0,-1);return i.indexOf(r)||(i=i.slice(r.length)),i.slice(1)},onDocClick:function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return!0;var n=e.target,i=t.getHrefAndTarget(n);n=i.target;var r=i.href;if(d.checkUrl(r)&&!n.target){var a=t.getDatesetObj(n),s=d.createStateObject(r,a);return e.preventDefault(),d.pushState(s,!0),!1}},checkUrl:function(e,n){n||(n=t.parseUrl(e).origin);var i=/^javascript:/;return e&&s===n&&!i.test(e)},push:function(e,t){var n=this.createStateObject(e,t);this.pushState(n)},pushState:function(e,n){(n||this.checkUrl(e.url,e.origin))&&e.url!==d.getCurrentState().url&&(this.options.enablePushState&&t.isUndefined(e.data.href)&&e.url!==t.location.href&&o["true"==e.replace?"replaceState":"pushState"](e,e.title,e.url),this.onChange({state:e}))},onChange:function(e){var n,i=e&&e.state||d.getUrlState(t.location.href),r=d.getCurrentState();if(r&&i.rurl===r.rurl)return void("popstate"!==e.type&&i.hash&&(n=t.document.getElementById(i.hash),n&&n.scrollIntoView()));var a=d.storeState(i),s="";if(a>d.index)s="forward";else{if(!(a<d.index))return e.preventDefault(),!1;s="back"}"back"!==s&&"back"===i.data.rel?s="back":"back"===s&&"back"!==i.data.rel&&"back"===r.data.rel&&(s="forward"),t.document.title=i.title,d.index=a,d.trigger(s,i,r),d.trigger("change",s,i,r)},getUrlState:function(e){return e=t.getFullUrl(e),n[e]||this.createStateObject(e)},getCurrentState:function(){var e=i[this.index];return e?n[e]||null:null},getPrevState:function(){var e=i[this.index-1];return e?n[e]||null:null},createStateObject:function(e,n,i){e?"/"===e.charAt(0)&&(e=e.slice(1),e=this.base+e):e=t.location.href;var r=t.parseUrl(e);return{data:n||(n={}),title:i||n.title||t.document.title,rurl:r.rurl,url:r.url,origin:r.origin,hash:r.hash}},hasUrl:function(e){return!!n[e]},storeState:function(e){var r=-1,a=e.rurl;return this.hasUrl(a)?r=i.indexOf(a):(i.push(a),r=i.length-1),n[a]=t.extend(!0,n[a],e),this.clearCache(r),r},clearCache:function(e){t.isUndefined(e)&&(e=-1);var r=i.slice(e+1);r.forEach(function(e){delete n[e]}),i.length=e+1},getCache:function(){return{urlCache:i,stateCache:n}}};return t.extendByBase(d),d}),function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m.router",function(require){var n=require("m.history");return n.router=t(e,n,n.history),n}):M.router=t(e,M,M.history)}(this,function(e,t,n){function i(e,n,i){e?(e.setRouteView(this),this.$parentRoute=e):this.$parentRoute=null,n&&(this.$parent=n),this.routes=[],this.maskEle=null,this.pageViewState=null,this.viewsContainer=null,this.options=i,this.pagesCache=[],this.templateCache={},this.options.cacheViewsNum<1&&(this.options.cacheViewsNum=1),e||this.setViewsContainer(t.document.body)}function r(e,n,i){i=i||{},i.callback=n||t.noop,e.length>2&&"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1),i.last="/"),i=h(e,i),delete i.path,delete i.last,this.routeView=null,this.instances=[],this.path=e,this.activeIndex=-1,this._actived=!1,t.each(["cacheTemplate","viewClass","redirectTo","redirectPushState","callback","getTemplate","onActive","onDestroy","onEnter","onLeave","regexp","$regexp","keys","parentArgsLen"],function(e){this[e]=i[e],delete i[e]},this);var r=this.redirectTo;t.isString(r)&&(this.redirectTo=function(){return r}),this.redirectTo&&t.isUndefined(this.redirectPushState)&&(this.redirectPushState=!0),this.parentArgsLen||(this.parentArgsLen=0),this.options=i}function a(e,t,n,i,r){this.route=e,this.path=t,this.query=n,this.options=r,this.params={},this.args=null,this.element=null,this.cached=!1,this._oldTemplate="",this.destroyed=!1,this.setArgs(i)}function s(e){var t=n.getPath(e);return t||n.base?(t&&"/"===t||(t="/"+(t||"")),d(t)):null}function o(e,n){var i=e.route[n];return t.isFunction(i)&&i.apply(e,e.args)}function h(e,t){for(var n,i,r,a,s=t.keys=[],o="boolean"==typeof t.caseInsensitive?t.caseInsensitive:!0,h="^",c=0;n=v.exec(e);){i=n[2]||n[3],r=n[4]||("*"==n[1]?".*":"string"),a=e.substring(c,n.index);var l=k.$types[r],d={name:i};l&&(r=l.pattern,d.decode=l.decode),s.push(d),h+=u(a,r,!1),c=v.lastIndex}return a=e.substring(c),h+=u(a),t.children&&(t.$regexp=new RegExp(h,o?"i":void 0)),h+=(t.strict?t.last:"/?")+"$",t.regexp=new RegExp(h,o?"i":void 0),t}function u(e,t,n){var i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;var r=n?"?":"";return i+r+"("+t+")"+r}function c(e,t,n){for(var i=0,r=t.length;r>i;i++){var a=t[i],s=e[i]||"";if("function"==typeof a.decode)var o=a.decode(s);else try{o=JSON.parse(s)}catch(h){o=s}e[i]=n.params[a.name]=o}n.args=e}function l(e){var t=e.args;if(!t)return void(e.args=[]);if(e.route.keys.length){var n=e.route.parentArgsLen;t.splice(0,n)}else t.length=0}function d(e){var t=e.split("?"),n={},i=t[0],r=t[1];if(r)for(var a,s=r.split("&"),o=s.length,h=0;o>h;h++)s[h]&&(a=s[h].split("="),n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]));return{path:i,query:n}}function f(e){var n;e&&(n=t.document.getElementById(e),n&&n.scrollIntoView())}function p(e){e&&e.parentNode&&e.parentNode.removeChild(e)}var v=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,g=!1,m="page-view",y="in",w={cacheTemplate:!0,viewsSelector:"",viewClass:"",animation:!0,aniClass:"slide",maskClass:"mask",showLoading:!0,cacheViewsNum:3},C=Object.keys(w),S=t.document.createElement("div"),b=function(){for(var e,t=S.style,n=["a","webkitA","MozA","OA","msA"],i=["animationend","webkitAnimationEnd","animationend","oAnimationEnd","MSAnimationEnd"],r=0,a=n.length;a>r;r++)if(e=n[r]+"nimation",e in t)return i[r];return"animationend"}();t.extend(i.prototype,{route:function(e,n,i,r,a){var s=this.routes;i||(i={});for(var o,h,u,c=!1,l=this,d=0;o=s[d];d++){var f=e.match(r&&o.$regexp||o.regexp);if(f){h=f.shift(),u=o.ins(h,n||{},f,i);for(var p,v,g=l;g&&(p=g.$parentRoute);){if(v=p.ele(),!l.viewsContainer||!v||!p.actived())return l.$parent.route(u.path,u.query,t.extend({matchIns:u},i),e,function(){delete l.$parent.pageViewState.options.matchIns,l.pageViewState&&l.pageViewState.path===e||(l._waiting=!0,l._route(u,a))}),!0;g=g.$parent}l._route(u,a),c=!0}else r||o.routeView&&(c=o.routeView.route(e,n,i));if(c)break}return c},_redirectTo:function(e,n){function i(){!e.element&&a.destroyIns(e);var i={};n||(i.redirectToSync=!0),a.redirectPushState||(i.href=r),t.router.navigate(r,i)}var r,a=e.route;return a.redirectTo&&(r=o(e,"redirectTo"))&&!e.equalTo(r,!0)?(n?t.nextTick(i):i(),!0):!1},_route:function(e,n){function i(t){s.getTemplateCb(e,t,n)}var r,a=e.route,s=this,h=this.getOption(a,e.options.state,"cacheTemplate"),u=t.getUIDByKey(e.path);!e.options.first||!(r=this.viewsContainer.getElementsByClassName(m)[0])||r.id&&r.id!==u||(this.templateCache[e.path]=r.innerHTML,h=!0),t.isString(h)&&(h="true"===h);var c=e.args;if(h&&this.templateCache[e.path]||!a.getTemplate){if(!a.getTemplate&&!n&&this._redirectTo(e,!0))return;o(e,"onActive"),k.trigger("routeChangeStart",e,c),i(this.templateCache[e.path])}else o(e,"onActive"),k.trigger("routeChangeStart",e,c),this.showLoading(),a.getTemplate.length>0?(this._waiting=!1,a.getTemplate.call(e,i)):i(a.getTemplate.call(e))},setViewsContainer:function(e){var t,n;e&&(n=this.options.viewsSelector,t=n&&e.querySelector(n)),this.viewsContainer=t||e||null},showLoading:function(e){(this.options.showLoading||e)&&(this.maskEle||this.initMaskEle(),this.maskEle.style.visibility="visible")},initMaskEle:function(){this.maskEle=S.cloneNode(),this.maskEle.className=this.options.maskClass,this.maskEle.innerHTML='<i class="'+this.options.maskClass+'-loading"></i>',this.viewsContainer.appendChild(this.maskEle)},hideLoading:function(){this.maskEle&&(this.maskEle.style.visibility="hidden")},getOption:function(e,n,i){if(!e&&!n)return void 0;if(!i)return void 0;var r;return n&&(r=n.data[i]),t.isUndefined(r)&&(r=e[i],t.isUndefined(r)&&(r=this.options[i])),r},getTemplateCb:function(e,n,i){function r(n){e.setEle(n);var i=t.Array.indexOfByKey(c.pagesCache,e,"path");~i&&c.pagesCache.splice(i,1),c.pagesCache.push(e),c.pageViewState=e,s(),h()}function a(){s(),o(e,"onEnter"),h()}function s(){g&&S&&(S.defaultTemplate||!e.cached)&&(t.innerHTML(v,n),e.cached=!1)}function h(){S&&S.setViewsContainer(e.element),o(e,"callback"),k.trigger("routeChangeEnd",e,e.args),i&&i(),delete c._waiting,!C&&!i&&c._redirectTo(e)}this.hideLoading(),e._oldTemplate=this.templateCache[e.path],this.templateCache[e.path]=n;var u,c=this,l=e.options,d=l.first||!this.pageViewState,f=t.getUIDByKey(e.path);d&&(l.first=d,u=this.viewsContainer.getElementsByClassName(m)[0],p(this.maskEle),this.viewsContainer&&this.$parentRoute&&this.viewsContainer!==this.$parentRoute.ele()&&(this.defaultTemplate=this.viewsContainer.innerHTML,u||(t.innerHTML(this.viewsContainer,""),this.maskEle=null)),this.maskEle&&this.viewsContainer.appendChild(this.maskEle));var v=t.document.getElementById(f);v?e.cached=!0:(v=u||t.document.createElement("div"),v.id=f,e.cached=!1,!u&&this.viewsContainer.appendChild(v));var g=t.hasClass(v,y),w=e.route,C=!1;if(g&&e.element===v&&c._redirectTo(e,!0))return C=!0,void a();(!e.cached&&!u||n!==e._oldTemplate)&&(g||t.innerHTML(v,n),e.cached=!1);var S=w.routeView;if(S){if(g)return void(S.pageViewState?S._transView(null,S.pageViewState,l,a):a());if(S.pageViewState){var b,_=e.options.matchIns,V=!1;if(_){b=_.route;for(var T,A=S;!V&&A&&A.pageViewState;)T=A.pageViewState.route.routeView,b==A.pageViewState.route?(V=!0,_.path!==A.pageViewState.path&&A._transView(null,A.pageViewState,l),T&&T.pageViewState&&T._transView(null,T.pageViewState,l)):A=T}V||S._transView(null,S.pageViewState,l)}}this._transView(v,e,l,r)},_transView:function(e,n,i,r){function a(e,t){setTimeout(function(){t&&e.removeEventListener(b,t)})}function s(){if(!e){r&&r(),h();var n=t.Array.indexOfByKey(S.pagesCache,S.pageViewState,"path");return n>=0&&S.pagesCache.splice(n,1),S.pageViewState.route.destroyIns(S.pageViewState),S.pageViewState=null,void(S.defaultTemplate&&t.innerHTML(S.viewsContainer,S.defaultTemplate))}h()}function h(){setTimeout(function(){t.removeClass(S.viewsContainer,g)},100),T&&A&&S.checkPageViews()}var u=y,c="out",l=c,d="reverse",p="ani",v=u+" "+d,g="overhidden",w=this.pageViewState,C=w&&w.element,S=this;e&&(t.removeClass(e,v),t.addClass(e,m+" "+this.options.viewClass));var k=this._shouldAni(this.options.animation,n,i);if(k=k&&!!r&&!n.redirectTo&&!n.options.state.data.redirectToSync){var _=p,V=p;_+=" "+this.getOption(n.route,i.state,"aniClass"),i.first||(V+=" "+this.getOption(w.route,i.oldState,"aniClass")),u=_+" "+u,c=V+" "+c,t.addClass(this.viewsContainer,g)}"back"===i.direction&&(u+=" "+d,c+=" "+d),C&&(t.removeClass(C,v),t.addClass(C,c),C.offsetWidth=C.offsetWidth,o(w,"onLeave"),w.route.actived(!1)),e&&(t.removeClass(e,l),t.addClass(e,u),e.offsetWidth=e.offsetWidth,o(n,"onEnter")),!n.cached&&i.state.hash&&f(i.state.hash);var T=!1,A=!1;return k?(e&&e.addEventListener(b,function x(){T=!0,a(e,x),t.removeClass(e,_),r&&r(e),h()}),void(C&&C.addEventListener(b,function E(){A=!0,a(C,E),t.removeClass(C,V),s()}))):(T=!0,A=!0,r&&r(e),r=null,void s())},_shouldAni:function(e,t,n){var i=this.getOption(t.route,n.state,"animation"),r=e;return n.first||(r=this.getOption(this.pageViewState.route,n.oldState,"animation")),i=1==i||"true"==i?!0:!1,r=1==r||"true"==r?!0:!1,e=i&&r&&(!this._waiting||!n.first),n.first&&(e=e&&!!this.$parentRoute),e},checkPageViews:function(){var e=this.options.cacheViewsNum,n=this.pagesCache;if(!(n.length<=e)){var i=t.Array.indexOfByKey(n,this.pageViewState,"path"),r=0,a=0;for(r=i-Math.floor((e-1)/2),0>r&&(r=0),a=e-1+r,a>n.length-1&&(r-=a-n.length+1,a=n.length-1);r>0;)this.destroyRouteIns(n.shift()),r--,a--;for(;a<n.length-1;)this.destroyRouteIns(n.pop())}},destroyRouteIns:function(e){var t=e.route,n=t.routeView;if(n){for(var i=n.pagesCache.shift();i;)n.destroyRouteIns(i),i=n.pagesCache.shift();n.pageViewState=null,n.$parentRoute.ele()!=this.pageViewState.element&&n.setViewsContainer(),p(n.maskEle),n.maskEle=null}o(e,"onDestroy"),t.destroyIns(e),e=null},getTemplateCache:function(){return this.templateCache}}),t.extend(r.prototype,{ins:function(e,n,i,r){var s=this,o=null;return t.each(s.instances,function(t,a){return s.checkEqual(t,e,n)?(o=t,s.setActive(a),o.setOptions(r),o.setArgs(i),!1):void 0}),o?o:(o=new a(this,e,n,i,r),this.instances.push(o),this.setActive(this.instances.length-1),o)},checkEqual:function(e,t,n){return e.path===t},getIns:function(e){return this.instances[e]},getActive:function(){return this.getIns(this.activeIndex)},setActive:function(e){this.activeIndex=e,this.actived(this.getIns(e))},setRouteView:function(e){this.routeView=e},ele:function(){var e=this.getActive()||null;return e&&e.element},actived:function(e){return t.isUndefined(e)?this._actived:void(this._actived=!!e)},destroyIns:function(e){if(e){return this.getActive()===e?(this.instances.splice(this.activeIndex,1),this.setActive(-1),void e.destroy()):void t.each(this.instances,function(t,n){return t===e?(this.instances.splice(n,1),this.activeIndex>n&&this.setActive(this.activeIndex-1),e.destroy(),!1):void 0},this)}}}),t.extend(a.prototype,{setArgs:function(e){this.route.keys.length?(c(e,this.route.keys,this),l(this)):this.args=[]},setOptions:function(e){this.destroyed||(this.options=e)},setEle:function(e){this.element=e},equalTo:function(e,t){var n=s(e);return n&&this.route.checkEqual(this,n.path,n.query)?(t&&(this.query=n.query),!0):!1},destroy:function(){this.destroyed||(this.route=null,this.path="",this.query=null,this.options=null,this.params=null,this.args=null,this.element&&p(this.element),this.element=null,this.destroyed=!0)}});var k={errorback:null,init:function(e,n){if(!g&&(e||n)){g=!0,t.isArray(e)||(n=e,e=[]),n&&t.isFunction(n.error)&&(this.error(n.error),delete n.error);var r={};t.extend(r,w,n||{}),this.routeView=new i(null,null,r),this._add(e)}},route:function(e,t,n){e=e.trim();var i=this.routeView.route(e,t,n);!i&&this.errorback&&this.errorback(e,t,n)},error:function(e){this.errorback=e},_add:function(e,n,i,r){var a;i||(i=""),t.each(e,function(e){a=e.path;var t=0;i&&(a=i+a,r.parentArgsLen&&(t+=r.parentArgsLen),t+=r.keys.length,e.parentArgsLen=t),this.add(a||"/",e.callback,e,n)},this)},add:function(e,n,a,s){"object"==typeof n&&(s=a,a=n),s||(s=this.routeView);var o=s.routes;if("/"!==e.charAt(0))throw"path必须以/开头";var h=new r(e,n,a);t.Array.ensure(o,h);var u=a.children;if(u){delete a.children;var c={},l=s.options;t.each(C,function(e){c[e]=e in u?u[e]:l[e]});var d=new i(h,s,c);routes=u.routes,delete u.routes,this._add(routes,d,e,h)}},navigate:function(e,t){"/"===e.charAt(1)&&(e=e.slice(1)),n.push(e,t)},$types:{date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(e){return new Date(e.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{pattern:"0|1",decode:function(e){return 0===parseInt(e,10)?!1:!0}},"int":{pattern:"\\d+",decode:function(e){return parseInt(e,10)}}}};return t.extendByBase(k),n.on("change",function(e,t,n){var i=!1;n||(i=!0);var r=s(t.url);r&&k.route(r.path,r.query,{first:i,direction:e,state:t,oldState:n})}),k});